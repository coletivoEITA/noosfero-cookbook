# encoding: utf-8
# Backup model
# Generated by Chef

Backup::Model.new <%= @service_name.inspect %>, "Database and data files" do
  database PostgreSQL do |db|
    db.name = <%= @db[:name].inspect %>
    db.host = <%= @db[:hostname].inspect %>
    db.port = <%= @db[:port].inspect %>
    db.username = <%= @db[:username].inspect %>
    db.password = <%= @db[:password].inspect %>
  end

  store_with Hg do |hg|
    hg.ip = <%= @backup[:to][:host].inspect %>
    hg.port = <%= @backup[:to][:port].inspect %>
    hg.username = <%= @backup[:to][:user].inspect %>
    hg.path = <%= @backup[:to][:path].inspect %>

  <% if @paths_in_code %>
    hg.syncer.add <%= @code_path.inspect %>
  <% elsif @user_install %>
  <% %w[ code data config log run tmp ].each do |dir| %>
    hg.syncer.add <%= instance_variable_get("@#{dir}_path").inspect %>
  <% end %>
  <% else #TODO %>
  <% end %>

    hg.syncer.exclude '.git'
    hg.syncer.exclude '.sass-cache'
    hg.syncer.exclude 'tmp/sass-cache'
    hg.syncer.exclude 'tmp/attachment_fu'
  end
end
