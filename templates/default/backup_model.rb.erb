# encoding: utf-8
# Backup model
# Generated by Chef

Backup::Model.new <%= @site.service_name.inspect %>, "Database and data files" do
  database PostgreSQL do |db|
    db.name = <%= @site.db.name.inspect %>
    db.host = <%= @site.db.hostname.inspect %>
    db.port = <%= @site.db.port.inspect %>
    db.username = <%= @site.db.username.inspect %>
    db.password = <%= @site.db.password.inspect %>
  end

  store_with Hg do |hg|
    hg.ip = <%= @site.backup.host.inspect %>
    hg.port = <%= @site.backup.port.inspect %>
    hg.username = <%= @site.backup.user.inspect %>
    hg.path = <%= @site.backup.path.inspect %>

  <% if @site.paths_in_code %>
    hg.syncer.add <%= @site.code_path.inspect %>
  <% elsif @site.user_install %>
  <% %w[ code data config log run tmp ].each do |dir| %>
    hg.syncer.add <%= @site.send("#{dir}_path").inspect %>
  <% end %>
  <% else #TODO %>
  <% end %>

    hg.syncer.exclude '.git'
    hg.syncer.exclude '.sass-cache'
    hg.syncer.exclude 'tmp/sass-cache'
    hg.syncer.exclude 'tmp/attachment_fu'
  end
end
